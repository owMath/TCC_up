<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Sistema OEE</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --text-light: #ffffff;
            --text-dark: #333333;
            --background-light: #f5f5f5;
            --background-white: #ffffff;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            height: 100vh;
            background-color: var(--background-light);
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color:#1a73e8;
            color: white;
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .menu-item {
            text-decoration: none;
            color: white;
        }
        
        .menu-item a {
            text-decoration: none;
            color: inherit;
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .menu-item:hover, .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        /* Main Content */
        .main-content {
            flex-grow: 1;
            margin-left: 250px;
            padding: 20px;
            box-sizing: border-box;
            width: calc(100% - 250px); /* Garante que o conteúdo tenha largura correta */
        }

        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-name {
            margin-right: 10px;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .page-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .report-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .report-card {
            background-color: var(--background-white);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .report-card h3 {
            margin-bottom: 15px;
            color: var(--primary-dark);
        }
        
        .report-card p {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .report-card .actions {
            display: flex;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            margin-right: 10px;
        }
        
        .btn-outline:hover {
            background-color: rgba(26, 115, 232, 0.1);
        }
        
        .report-filters {
            background-color: var(--background-white);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-item {
            display: flex;
            flex-direction: column;
        }
        
        .filter-item label {
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-dark);
        }
        
        .filter-item select,
        .filter-item input {
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        .custom-report {
            background-color: var(--background-white);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .custom-report h2 {
            margin-bottom: 20px;
            color: var(--primary-dark);
        }
        
        .metric-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-item {
            display: flex;
            align-items: center;
        }
        
        .metric-item input {
            margin-right: 8px;
        }

        /* Novos estilos para modais e visualização de relatórios */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        
        .modal-content {
            background-color: var(--background-white);
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 1000px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: var(--text-dark);
        }
        
        .modal-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .modal-body {
            margin-bottom: 20px;
            min-height: 300px;
        }
        
        .modal-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            display: flex;
            justify-content: flex-end;
        }

        /* Estilos para visualização de gráficos */
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
        }
        
        /* Estilos para tabelas */
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .report-table th, .report-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .report-table th {
            background-color: var(--background-light);
            font-weight: 600;
        }
        
        .report-table tr:hover {
            background-color: rgba(26, 115, 232, 0.05);
        }

        /* Estilos para datas personalizadas */
        .date-range-container {
            display: none;
            margin-top: 15px;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .date-range-container.active {
            display: grid;
        }
        
        /* Notificações e mensagens */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Biblioteca de gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Sistema OEE</h2>
            <p>Painel de Controle</p>
        </div>
        <div class="menu">
            <a href="dashboard.html" class="menu-item">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="maquinas.html" class="menu-item">
                <i class="fas fa-industry"></i>
                <span>Máquinas</span>
            </a>
            <a href="relatorios.html" class="menu-item active">
                <i class="fas fa-chart-line"></i>
                <span>Relatórios</span>
            </a>
            <a href="logistica.html" class="menu-item">
                <i class="fas fa-truck"></i>
                <span>Logística</span>
            </a>
            <a href="configuracoes.html" class="menu-item">
                <i class="fas fa-cog"></i>
                <span>Configurações</span>
            </a>
            <a href="perfil.html" class="menu-item">
                <i class="fas fa-user"></i>
                <span>Perfil</span>
            </a>
        </div>
    </div>
    
    <div class="main-content">
        <div class="page-header">
            <h2>Relatórios</h2>
            <div class="user-info">
                <span class="user-name" id="user-name">Usuário</span>
                <button class="logout-btn" id="logout-btn">Sair</button>
            </div>
        </div>
        <div class="report-filters">
            <h2>Filtros</h2>
            <div class="filter-grid">
                <div class="filter-item">
                    <label for="date-range">Período</label>
                    <select id="date-range">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="last7">Últimos 7 dias</option>
                        <option value="last30" selected>Últimos 30 dias</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label for="machine">Máquina</label>
                    <select id="machine">
                        <option value="all" selected>Todas</option>
                        <option value="machine1">Máquina 1</option>
                        <option value="machine2">Máquina 2</option>
                        <option value="machine3">Máquina 3</option>
                        <option value="machine4">Máquina 4</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label for="metric">Indicador</label>
                    <select id="metric">
                        <option value="oee" selected>OEE</option>
                        <option value="availability">Disponibilidade</option>
                        <option value="performance">Performance</option>
                        <option value="quality">Qualidade</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label for="group-by">Agrupar por</label>
                    <select id="group-by">
                        <option value="day">Dia</option>
                        <option value="week">Semana</option>
                        <option value="month" selected>Mês</option>
                    </select>
                </div>
            </div>
            
            <!-- Datas personalizadas (inicialmente oculto) -->
            <div class="date-range-container" id="custom-date-range">
                <div class="filter-item">
                    <label for="start-date">Data Inicial</label>
                    <input type="date" id="start-date">
                </div>
                <div class="filter-item">
                    <label for="end-date">Data Final</label>
                    <input type="date" id="end-date">
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-outline" id="clear-filter-btn">Limpar</button>
                <button class="btn btn-primary" id="apply-filter-btn">Aplicar</button>
            </div>
        </div>
        
        <div class="report-container">
            <div class="report-card">
                <h3>Evolução do OEE</h3>
                <p>Análise da evolução do indicador OEE ao longo do tempo, permitindo identificar tendências e padrões.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="oee-evolution">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="oee-evolution">Exportar</button>
                </div>
            </div>
            
            <div class="report-card">
                <h3>Análise de Paradas</h3>
                <p>Relatório detalhado das paradas de máquinas, categorização e impacto na disponibilidade.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="stop-analysis">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="stop-analysis">Exportar</button>
                </div>
            </div>
            
            <div class="report-card">
                <h3>Desempenho por Máquina</h3>
                <p>Comparativo entre o desempenho de diferentes máquinas, destacando pontos fortes e fracos.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="machine-performance">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="machine-performance">Exportar</button>
                </div>
            </div>
            
            <div class="report-card">
                <h3>Perdas de Produção</h3>
                <p>Quantificação das perdas de produção relacionadas a cada componente do OEE.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="production-losses">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="production-losses">Exportar</button>
                </div>
            </div>
            
            <div class="report-card">
                <h3>Gestão Logística</h3>
                <p>Análise do fluxo de materiais e impacto no planejamento de produção.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="logistics-management">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="logistics-management">Exportar</button>
                </div>
            </div>
            
            <div class="report-card">
                <h3>Ordens de Produção</h3>
                <p>Status e eficiência das ordens de produção em andamento e finalizadas.</p>
                <div class="actions">
                    <button class="btn btn-outline view-report" data-report="production-orders">Visualizar</button>
                    <button class="btn btn-primary export-report" data-report="production-orders">Exportar</button>
                </div>
            </div>
        </div>
        
        <div class="custom-report">
            <h2>Relatório Personalizado</h2>
            <p>Selecione os indicadores que deseja incluir no seu relatório personalizado:</p>
            
            <div class="metric-selector">
                <div class="metric-item">
                    <input type="checkbox" id="metric-oee" checked>
                    <label for="metric-oee">OEE</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-availability" checked>
                    <label for="metric-availability">Disponibilidade</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-performance" checked>
                    <label for="metric-performance">Performance</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-quality" checked>
                    <label for="metric-quality">Qualidade</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-stops">
                    <label for="metric-stops">Paradas</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-production">
                    <label for="metric-production">Produção</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-logistics">
                    <label for="metric-logistics">Logística</label>
                </div>
                
                <div class="metric-item">
                    <input type="checkbox" id="metric-rejects">
                    <label for="metric-rejects">Rejeitos</label>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn btn-outline" id="clear-custom-report">Limpar</button>
                <button class="btn btn-primary" id="generate-custom-report">Gerar Relatório</button>
            </div>
        </div>
    </div>

    <!-- Modais para Visualização de Relatórios -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 id="report-modal-title">Título do Relatório</h2>
            </div>
            <div class="modal-body" id="report-modal-body">
                <!-- Conteúdo do relatório será inserido aqui dinamicamente -->
                <div class="chart-container">
                    <canvas id="report-chart"></canvas>
                </div>
                <div id="report-table-container"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="print-report">Imprimir</button>
                <button class="btn btn-primary" id="export-modal-report">Exportar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Relatório Personalizado -->
    <div id="custom-report-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2>Relatório Personalizado</h2>
            </div>
            <div class="modal-body" id="custom-report-body">
                <!-- Conteúdo do relatório personalizado será inserido aqui dinamicamente -->
                <div id="custom-charts-container"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="print-custom-report">Imprimir</button>
                <button class="btn btn-primary" id="export-custom-report">Exportar</button>
            </div>
        </div>
    </div>

    <!-- Contêiner de Notificação -->
    <div class="notification" id="notification">
        Notificação
    </div>
    
    <script>
        // Dados de exemplo para simulação dos relatórios
        const mockData = {
            // Dados para evolução do OEE
            'oee-evolution': {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                datasets: [
                    {
                        label: 'OEE (%)',
                        data: [68, 72, 75, 73, 78, 82, 85, 87, 84, 86, 89, 91],
                        borderColor: '#1a73e8',
                        backgroundColor: 'rgba(26, 115, 232, 0.1)',
                        fill: true
                    }
                ],
                tableData: [
                    { mes: 'Janeiro', oee: '68%', disponibilidade: '78%', performance: '87%', qualidade: '92%' },
                    { mes: 'Fevereiro', oee: '72%', disponibilidade: '82%', performance: '88%', qualidade: '93%' },
                    { mes: 'Março', oee: '75%', disponibilidade: '85%', performance: '89%', qualidade: '94%' },
                    { mes: 'Abril', oee: '73%', disponibilidade: '83%', performance: '87%', qualidade: '93%' },
                    { mes: 'Maio', oee: '78%', disponibilidade: '86%', performance: '90%', qualidade: '95%' },
                    { mes: 'Junho', oee: '82%', disponibilidade: '89%', performance: '92%', qualidade: '96%' },
                    { mes: 'Julho', oee: '85%', disponibilidade: '91%', performance: '93%', qualidade: '97%' },
                    { mes: 'Agosto', oee: '87%', disponibilidade: '92%', performance: '94%', qualidade: '97%' },
                    { mes: 'Setembro', oee: '84%', disponibilidade: '90%', performance: '92%', qualidade: '96%' },
                    { mes: 'Outubro', oee: '86%', disponibilidade: '91%', performance: '93%', qualidade: '97%' },
                    { mes: 'Novembro', oee: '89%', disponibilidade: '93%', performance: '95%', qualidade: '98%' },
                    { mes: 'Dezembro', oee: '91%', disponibilidade: '94%', performance: '96%', qualidade: '98%' }
                ]
            },
            
            // Dados para análise de paradas
            'stop-analysis': {
                labels: ['Manutenção Preventiva', 'Troca de Ferramentas', 'Ajustes', 'Falha Operacional', 'Quebra', 'Falta de Material'],
                datasets: [
                    {
                        label: 'Horas Paradas',
                        data: [45, 32, 18, 12, 28, 15],
                        backgroundColor: [
                            '#1a73e8', '#4285f4', '#34a853', '#fbbc05', '#ea4335', '#9c27b0'
                        ]
                    }
                ],
                tableData: [
                    { categoria: 'Manutenção Preventiva', horas: 45, percentual: '30%', impacto: 'Médio' },
                    { categoria: 'Troca de Ferramentas', horas: 32, percentual: '21.3%', impacto: 'Médio' },
                    { categoria: 'Ajustes', horas: 18, percentual: '12%', impacto: 'Baixo' },
                    { categoria: 'Falha Operacional', horas: 12, percentual: '8%', impacto: 'Baixo' },
                    { categoria: 'Quebra', horas: 28, percentual: '18.7%', impacto: 'Alto' },
                    { categoria: 'Falta de Material', horas: 15, percentual: '10%', impacto: 'Médio' }
                ]
            },
            
            // Dados para desempenho por máquina
            'machine-performance': {
                labels: ['Máquina 1', 'Máquina 2', 'Máquina 3', 'Máquina 4'],
                datasets: [
                    {
                        label: 'OEE (%)',
                        data: [87, 82, 91, 78],
                        backgroundColor: '#1a73e8'
                    },
                    {
                        label: 'Disponibilidade (%)',
                        data: [92, 88, 95, 83],
                        backgroundColor: '#34a853'
                    },
                    {
                        label: 'Performance (%)',
                        data: [94, 90, 96, 89],
                        backgroundColor: '#fbbc05'
                    },
                    {
                        label: 'Qualidade (%)',
                        data: [97, 96, 98, 94],
                        backgroundColor: '#ea4335'
                    }
                ],
                tableData: [
                    { maquina: 'Máquina 1', oee: '87%', disponibilidade: '92%', performance: '94%', qualidade: '97%' },
                    { maquina: 'Máquina 2', oee: '82%', disponibilidade: '88%', performance: '90%', qualidade: '96%' },
                    { maquina: 'Máquina 3', oee: '91%', disponibilidade: '95%', performance: '96%', qualidade: '98%' },
                    { maquina: 'Máquina 4', oee: '78%', disponibilidade: '83%', performance: '89%', qualidade: '94%' }
                ]
            },
            
            // Dados para perdas de produção
            'production-losses': {
                labels: ['Disponibilidade', 'Performance', 'Qualidade'],
                datasets: [
                    {
                        label: 'Perdas (%)',
                        data: [12, 8, 3],
                        backgroundColor: ['#ea4335', '#fbbc05', '#34a853']
                    }
                ],
                tableData: [
                    { categoria: 'Perdas de Disponibilidade', percentual: '12%', impacto: 'Alto', causas: 'Paradas não planejadas, setup' },
                    { categoria: 'Perdas de Performance', percentual: '8%', impacto: 'Médio', causas: 'Velocidade reduzida, micro paradas' },
                    { categoria: 'Perdas de Qualidade', percentual: '3%', impacto: 'Baixo', causas: 'Rejeitos, retrabalho' }
                ]
            },
            
            // Dados para gestão logística
            'logistics-management': {
                labels: ['Recebimento', 'Armazenagem', 'Separação', 'Transporte', 'Entrega'],
                datasets: [
                    {
                        label: 'Tempo Médio (min)',
                        data: [35, 20, 45, 30, 25],
                        backgroundColor: '#1a73e8'
                    },
                    {
                        label: 'Eficiência (%)',
                        data: [85, 92, 78, 88, 90],
                        backgroundColor: '#34a853'
                    }
                ],
                tableData: [
                    { etapa: 'Recebimento', tempoMedio: '35 min', eficiencia: '85%', gargalos: 'Conferência manual' },
                    { etapa: 'Armazenagem', tempoMedio: '20 min', eficiencia: '92%', gargalos: 'Nenhum significativo' },
                    { etapa: 'Separação', tempoMedio: '45 min', eficiencia: '78%', gargalos: 'Localização de itens' },
                    { etapa: 'Transporte', tempoMedio: '30 min', eficiencia: '88%', gargalos: 'Rotas ineficientes' },
                    { etapa: 'Entrega', tempoMedio: '25 min', eficiencia: '90%', gargalos: 'Documentação' }
                ]
            },
            
            // Dados para ordens de produção
            'production-orders': {
                labels: ['Em Espera', 'Em Andamento', 'Concluídas', 'Atrasadas'],
                datasets: [
                    {
                        label: 'Quantidade',
                        data: [8, 12, 45, 3],
                        backgroundColor: ['#1a73e8', '#fbbc05', '#34a853', '#ea4335']
                    }
                ],
                tableData: [
                    { ordem: 'OP-2025-001', produto: 'Produto A', status: 'Concluída', eficiencia: '94%', prazo: 'No prazo' },
                    { ordem: 'OP-2025-002', produto: 'Produto B', status: 'Em Andamento', eficiencia: '87%', prazo: 'No prazo' },
                    { ordem: 'OP-2025-003', produto: 'Produto C', status: 'Em Espera', eficiencia: 'N/A', prazo: 'N/A' },
                    { ordem: 'OP-2025-004', produto: 'Produto D', status: 'Atrasada', eficiencia: '76%', prazo: '2 dias' },
                    { ordem: 'OP-2025-005', produto: 'Produto E', status: 'Concluída', eficiencia: '92%', prazo: 'No prazo' }
                ]
            }
        };
        
        // Função para mostrar notificações
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.className = 'notification';
            }, 3000);
        }
        
        // Função para gerar tabela a partir de dados
        function generateTable(data) {
            if (!data || !data.length) return '<p>Nenhum dado disponível.</p>';
            
            // Extrair nomes das colunas do primeiro objeto
            const columns = Object.keys(data[0]);
            
            let tableHtml = '<table class="report-table">';
            
            // Cabeçalho da tabela
            tableHtml += '<thead><tr>';
            columns.forEach(column => {
                // Formatar nome da coluna (primeira letra maiúscula, remover underscores)
                const formattedColumn = column
                    .replace(/_/g, ' ')
                    .replace(/\b\w/g, c => c.toUpperCase());
                tableHtml += `<th>${formattedColumn}</th>`;
            });
            tableHtml += '</tr></thead>';
            
            // Corpo da tabela
            tableHtml += '<tbody>';
            data.forEach(row => {
                tableHtml += '<tr>';
                columns.forEach(column => {
                    tableHtml += `<td>${row[column]}</td>`;
                });
                tableHtml += '</tr>';
            });
            tableHtml += '</tbody></table>';
            
            return tableHtml;
        }
        
        // Função para criar gráficos
        function createChart(canvas, type, data, options = {}) {
            // Destruir gráfico anterior neste canvas específico, se existir
            const chartInstance = Chart.getChart(canvas);
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            // Configurações padrão
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: false
                    }
                }
            };
            
            // Mesclar opções padrão com opções personalizadas
            const chartOptions = { ...defaultOptions, ...options };
            
            // Criar novo gráfico
            const newChart = new Chart(canvas, {
                type: type,
                data: data,
                options: chartOptions
            });
            
            return newChart;
        }
        
        // Funções para exportar dados
        function exportToExcel(data, filename) {
            // Simulação de exportação para Excel
            showNotification(`Exportando ${filename} para Excel...`);
            
            // Em uma implementação real, aqui seria usada uma biblioteca como SheetJS
            setTimeout(() => {
                showNotification(`${filename} exportado com sucesso!`);
            }, 1500);
        }
        
        function printReport() {
            showNotification('Preparando impressão...');
            
            // Em uma implementação real, aqui seria chamado window.print()
            setTimeout(() => {
                showNotification('Documento enviado para impressão!');
            }, 1000);
        }
        
        // Função para obter período com base na seleção
        function getPeriodText() {
            const dateRange = document.getElementById('date-range').value;
            const machine = document.getElementById('machine').value;
            const metric = document.getElementById('metric').value;
            const groupBy = document.getElementById('group-by').value;
            
            let periodText = '';
            
            // Mapear valores para texto
            const dateRangeMap = {
                'today': 'Hoje',
                'yesterday': 'Ontem',
                'last7': 'Últimos 7 dias',
                'last30': 'Últimos 30 dias',
                'custom': 'Período personalizado'
            };
            
            const machineMap = {
                'all': 'Todas as máquinas',
                'machine1': 'Máquina 1',
                'machine2': 'Máquina 2',
                'machine3': 'Máquina 3',
                'machine4': 'Máquina 4'
            };
            
            const metricMap = {
                'oee': 'OEE',
                'availability': 'Disponibilidade',
                'performance': 'Performance',
                'quality': 'Qualidade'
            };
            
            const groupByMap = {
                'day': 'por dia',
                'week': 'por semana',
                'month': 'por mês'
            };
            
            // Construir texto do período
            if (dateRange === 'custom') {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                
                if (startDate && endDate) {
                    const formattedStartDate = new Date(startDate).toLocaleDateString('pt-BR');
                    const formattedEndDate = new Date(endDate).toLocaleDateString('pt-BR');
                    periodText = `De ${formattedStartDate} a ${formattedEndDate}`;
                } else {
                    periodText = 'Período personalizado';
                }
            } else {
                periodText = dateRangeMap[dateRange] || 'Período não especificado';
            }
            
            // Adicionar máquina e métrica
            const machineText = machineMap[machine] || 'Todas as máquinas';
            const metricText = metricMap[metric] || 'OEE';
            const groupByText = groupByMap[groupBy] || 'por mês';
            
            return `${periodText} - ${machineText} - ${metricText} ${groupByText}`;
        }
        
        // Função para renderizar relatório no modal
        function renderReport(reportId) {
            const modalTitle = document.getElementById('report-modal-title');
            const modalBody = document.getElementById('report-modal-body');
            const chartContainer = document.getElementById('report-chart');
            const tableContainer = document.getElementById('report-table-container');
            
            // Obter dados do relatório
            const reportData = mockData[reportId];
            
            // Verificar se os dados existem
            if (!reportData) {
                modalTitle.textContent = 'Erro';
                modalBody.innerHTML = '<p>Dados não encontrados para este relatório.</p>';
                return;
            }
            
            // Determinar o título do relatório
            let title = '';
            switch (reportId) {
                case 'oee-evolution':
                    title = 'Evolução do OEE';
                    break;
                case 'stop-analysis':
                    title = 'Análise de Paradas';
                    break;
                case 'machine-performance':
                    title = 'Desempenho por Máquina';
                    break;
                case 'production-losses':
                    title = 'Perdas de Produção';
                    break;
                case 'logistics-management':
                    title = 'Gestão Logística';
                    break;
                case 'production-orders':
                    title = 'Ordens de Produção';
                    break;
                default:
                    title = 'Relatório';
            }
            
            // Definir o título do modal
            modalTitle.textContent = title + ` (${getPeriodText()})`;
            
            // Determinar o tipo de gráfico com base no relatório
            let chartType = 'line';
            switch (reportId) {
                case 'oee-evolution':
                    chartType = 'line';
                    break;
                case 'stop-analysis':
                    chartType = 'pie';
                    break;
                case 'machine-performance':
                    chartType = 'bar';
                    break;
                case 'production-losses':
                    chartType = 'doughnut';
                    break;
                case 'logistics-management':
                    chartType = 'bar';
                    break;
                case 'production-orders':
                    chartType = 'pie';
                    break;
            }
            
            // Criar gráfico
            createChart(chartContainer, chartType, {
                labels: reportData.labels,
                datasets: reportData.datasets
            });
            
            // Gerar tabela
            tableContainer.innerHTML = generateTable(reportData.tableData);
            
            // Armazenar o ID do relatório atual para exportação
            document.getElementById('export-modal-report').dataset.report = reportId;
        }
        
        // Função para renderizar relatório personalizado
        function renderCustomReport() {
            const customChartContainer = document.getElementById('custom-charts-container');
            customChartContainer.innerHTML = '';
            
            // Obter métricas selecionadas
            const selectedMetrics = [];
            document.querySelectorAll('.metric-item input:checked').forEach(checkbox => {
                selectedMetrics.push({
                    id: checkbox.id.replace('metric-', ''),
                    name: checkbox.nextElementSibling.textContent
                });
            });
            
            // Verificar se pelo menos uma métrica foi selecionada
            if (selectedMetrics.length === 0) {
                customChartContainer.innerHTML = '<p>Selecione pelo menos uma métrica para gerar o relatório.</p>';
                return;
            }
            
            // Mapear métricas para dados e tipos de gráfico
            const metricMapping = {
                'oee': { 
                    data: mockData['oee-evolution'], 
                    type: 'line',
                    chartData: {
                        labels: mockData['oee-evolution'].labels,
                        datasets: [mockData['oee-evolution'].datasets[0]]
                    }
                },
                'availability': { 
                    data: mockData['oee-evolution'], 
                    type: 'line',
                    chartData: {
                        labels: mockData['oee-evolution'].labels,
                        datasets: [{
                            label: 'Disponibilidade (%)',
                            data: [78, 82, 85, 83, 86, 89, 91, 92, 90, 91, 93, 94],
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.1)',
                            fill: true
                        }]
                    }
                },
                'performance': { 
                    data: mockData['oee-evolution'], 
                    type: 'line',
                    chartData: {
                        labels: mockData['oee-evolution'].labels,
                        datasets: [{
                            label: 'Performance (%)',
                            data: [87, 88, 89, 87, 90, 92, 93, 94, 92, 93, 95, 96],
                            borderColor: '#fbbc05',
                            backgroundColor: 'rgba(251, 188, 5, 0.1)',
                            fill: true
                        }]
                    }
                },
                'quality': { 
                    data: mockData['oee-evolution'], 
                    type: 'line',
                    chartData: {
                        labels: mockData['oee-evolution'].labels,
                        datasets: [{
                            label: 'Qualidade (%)',
                            data: [92, 93, 94, 93, 95, 96, 97, 97, 96, 97, 98, 98],
                            borderColor: '#ea4335',
                            backgroundColor: 'rgba(234, 67, 53, 0.1)',
                            fill: true
                        }]
                    }
                },
                'stops': { 
                    data: mockData['stop-analysis'], 
                    type: 'pie',
                    chartData: {
                        labels: mockData['stop-analysis'].labels,
                        datasets: mockData['stop-analysis'].datasets
                    }
                },
                'production': { 
                    data: mockData['production-orders'], 
                    type: 'bar',
                    chartData: {
                        labels: mockData['production-orders'].labels,
                        datasets: mockData['production-orders'].datasets
                    }
                },
                'logistics': { 
                    data: mockData['logistics-management'], 
                    type: 'bar',
                    chartData: {
                        labels: mockData['logistics-management'].labels,
                        datasets: mockData['logistics-management'].datasets
                    }
                },
                'rejects': { 
                    data: mockData['production-losses'], 
                    type: 'doughnut',
                    chartData: {
                        labels: mockData['production-losses'].labels,
                        datasets: mockData['production-losses'].datasets
                    }
                }
            };
            
            // Criar gráficos e tabelas para cada métrica selecionada
            selectedMetrics.forEach((metric, index) => {
                const metricData = metricMapping[metric.id];
                
                if (!metricData || !metricData.data) {
                    return;
                }
                
                // Criar contêiner para o gráfico
                const chartSection = document.createElement('div');
                chartSection.className = 'chart-section';
                chartSection.style.marginBottom = '30px';
                
                // Título da seção
                const title = document.createElement('h3');
                title.textContent = metric.name;
                title.style.marginBottom = '15px';
                chartSection.appendChild(title);
                
                // Contêiner para o gráfico
                const canvasContainer = document.createElement('div');
                canvasContainer.style.height = '300px';
                canvasContainer.style.marginBottom = '20px';
                
                // Canvas para o gráfico
                const canvas = document.createElement('canvas');
                canvas.id = `chart-${metric.id}-${index}`;  // ID único para cada canvas
                canvasContainer.appendChild(canvas);
                chartSection.appendChild(canvasContainer);
                
                // Adicionar à seção principal primeiro para que o DOM tenha o canvas
                customChartContainer.appendChild(chartSection);
                
                // Criar o gráfico com dados específicos para esta métrica
                createChart(canvas, metricData.type, metricData.chartData);
                
                // Tabela com dados
                const tableDiv = document.createElement('div');
                tableDiv.innerHTML = generateTable(metricData.data.tableData);
                chartSection.appendChild(tableDiv);
            });
        }
        
        // Inicialização quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual para o campo de data final
            const today = new Date();
            const formattedToday = today.toISOString().split('T')[0];
            document.getElementById('end-date').value = formattedToday;
            
            // Definir data 30 dias atrás para o campo de data inicial
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            const formattedThirtyDaysAgo = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('start-date').value = formattedThirtyDaysAgo;
            
            // Referências para elementos DOM reutilizáveis
            const reportModal = document.getElementById('report-modal');
            const customReportModal = document.getElementById('custom-report-modal');
            const dateRangeSelect = document.getElementById('date-range');
            const customDateRange = document.getElementById('custom-date-range');
            
            // Tratamento para seleção do período personalizado
            dateRangeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateRange.style.display = 'grid';
                } else {
                    customDateRange.style.display = 'none';
                }
            });
            
            // Evento de fechar para modais
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    reportModal.style.display = 'none';
                    customReportModal.style.display = 'none';
                });
            });
            
            // Fechar modal ao clicar fora dele
            window.addEventListener('click', function(event) {
                if (event.target === reportModal) {
                    reportModal.style.display = 'none';
                }
                if (event.target === customReportModal) {
                    customReportModal.style.display = 'none';
                }
            });
            
            // Botão de aplicar filtros
            document.getElementById('apply-filter-btn').addEventListener('click', function() {
                // Aqui seria feita a chamada para API ou atualização dos dados
                // Nesta simulação, apenas mostramos uma notificação
                showNotification('Filtros aplicados com sucesso!');
            });
            
            // Botão de limpar filtros
            document.getElementById('clear-filter-btn').addEventListener('click', function() {
                document.getElementById('date-range').value = 'last30';
                document.getElementById('machine').value = 'all';
                document.getElementById('metric').value = 'oee';
                document.getElementById('group-by').value = 'month';
                customDateRange.style.display = 'none';
                
                showNotification('Filtros limpos!');
            });
            
            // Botões de visualizar relatório
            document.querySelectorAll('.view-report').forEach(button => {
                button.addEventListener('click', function() {
                    const reportId = this.dataset.report;
                    renderReport(reportId);
                    reportModal.style.display = 'block';
                });
            });
            
            // Botões de exportar relatório nos cards
            document.querySelectorAll('.export-report').forEach(button => {
                button.addEventListener('click', function() {
                    const reportId = this.dataset.report;
                    let reportName = '';
                    
                    switch (reportId) {
                        case 'oee-evolution':
                            reportName = 'Evolução do OEE';
                            break;
                        case 'stop-analysis':
                            reportName = 'Análise de Paradas';
                            break;
                        case 'machine-performance':
                            reportName = 'Desempenho por Máquina';
                            break;
                        case 'production-losses':
                            reportName = 'Perdas de Produção';
                            break;
                        case 'logistics-management':
                            reportName = 'Gestão Logística';
                            break;
                        case 'production-orders':
                            reportName = 'Ordens de Produção';
                            break;
                        default:
                            reportName = 'Relatório';
                    }
                    
                    exportToExcel(mockData[reportId], reportName);
                });
            });
            
            // Botão de exportar no modal
            document.getElementById('export-modal-report').addEventListener('click', function() {
                const reportId = this.dataset.report;
                const reportTitle = document.getElementById('report-modal-title').textContent;
                exportToExcel(mockData[reportId], reportTitle);
            });
            
            // Botão de imprimir
            document.getElementById('print-report').addEventListener('click', function() {
                printReport();
            });
            
            // Botão de limpar relatório personalizado
            document.getElementById('clear-custom-report').addEventListener('click', function() {
                document.querySelectorAll('.metric-item input').forEach(checkbox => {
                    if (checkbox.id === 'metric-oee' || 
                        checkbox.id === 'metric-availability' || 
                        checkbox.id === 'metric-performance' || 
                        checkbox.id === 'metric-quality') {
                        checkbox.checked = true;
                    } else {
                        checkbox.checked = false;
                    }
                });
                
                showNotification('Seleções de métricas redefinidas!');
            });
            
            // Botão de gerar relatório personalizado
            document.getElementById('generate-custom-report').addEventListener('click', function() {
                const selectedMetrics = document.querySelectorAll('.metric-item input:checked');
                
                if (selectedMetrics.length === 0) {
                    showNotification('Selecione pelo menos uma métrica para gerar o relatório', 'error');
                    return;
                }
                
                renderCustomReport();
                customReportModal.style.display = 'block';
            });
            
            // Botão de exportar relatório personalizado
            document.getElementById('export-custom-report').addEventListener('click', function() {
                const selectedMetrics = [];
                document.querySelectorAll('.metric-item input:checked').forEach(checkbox => {
                    selectedMetrics.push(checkbox.nextElementSibling.textContent);
                });
                
                exportToExcel(null, `Relatório Personalizado - ${selectedMetrics.join(', ')}`);
            });
            
            // Botão de imprimir relatório personalizado
            document.getElementById('print-custom-report').addEventListener('click', function() {
                printReport();
            });
            
            // Preencher o nome do usuário (simulado)
            document.getElementById('user-name').textContent = localStorage.getItem('user') ? 
                JSON.parse(localStorage.getItem('user')).name : 
                'Usuário';
                
            // Logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                showNotification('Logout realizado com sucesso!');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            });
        });
    </script>
</body>
</html>